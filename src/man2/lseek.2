.\" t
.\" Copyright (c) 1980, 1991 Regents of the University of California.
.\" and Copyright (c) 2011, Michael Kerrisk <mtk.manpages@gmail.com>
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)lseek.2	6.5 (Berkeley) 3/10/91
.\"
.\" Modified 1993-07-23 by Rik Faith <faith@cs.unc.edu>
.\" Modified 1995-06-10 by Andries Brouwer <aeb@cwi.nl>
.\" Modified 1996-10-31 by Eric S. Raymond <esr@thyrsus.com>
.\" Modified 1998-01-17 by Michael Haardt
.\"   <michael@cantor.informatik.rwth-aachen.de>
.\" Modified 2001-09-24 by Michael Haardt <michael@moria.de>
.\" Modified 2003-08-21 by Andries Brouwer <aeb@cwi.nl>
.\" 2011-09-18, mtk, Added SEEK_DATA + SEEK_HOLE
.\"
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH LSEEK 2 2011\-09\-25 Linux "Руководство программиста Linux"
.SH ИМЯ
lseek \- изменяет файловое смещение, используемое при чтении/записи
.SH ОБЗОР
\fB#include <sys/types.h>\fP
.br
\fB#include <unistd.h>\fP
.sp
\fBoff_t lseek(int \fP\fIfd\fP\fB, off_t \fP\fIoffset\fP\fB, int \fP\fIwhence\fP\fB);\fP
.SH ОПИСАНИЕ
Функция \fBlseek\fP() устанавливает смещение в файловом дескрипторе \fIfd\fP в
значение аргумента \fIoffset\fP в соответствии с директивой \fIwhence\fP, которая
может принимать одно из следующих значений:
.TP 
\fBSEEK_SET\fP
Установить смещение равным \fIoffset\fP (в байтах).
.TP 
\fBSEEK_CUR\fP
Установить смещение равным текущему положению плюс \fIoffset\fP (в байтах).
.TP 
\fBSEEK_END\fP
Установить смещение равным размеру файла плюс \fIoffset\fP (в байтах).
.PP
Функция \fBlseek\fP() позволяет задавать смещение, которое будет находиться за
существующим концом файла (но это не изменяет размер файла). Если позднее по
этому смещению будут записаны данные, то последующее чтение в промежутке
(«дырке») от конца файла до этого смещения, будет возвращать нулевые байты
(\(aq\e0\(aq), пока в этот промежуток действительно не будут записаны
данные.
.SS "Перемещения по данным файла и промежутки"
Начиная с версии 3.1, в Linux поддерживаются следующие дополнительные
значения \fIwhence\fP:
.TP 
\fBSEEK_DATA\fP
Подогнать файловое смещение к следующему расположению, большему или равному
значению \fIoffset\fP, по которому в файле есть данные. Если значение \fIoffset\fP
указывает на данные, то файловое смещение устанавливается в \fIoffset\fP.
.TP 
\fBSEEK_HOLE\fP
Подогнать файловое смещение к следующему промежутку, большему или равному
значению \fIoffset\fP. Если значение \fIoffset\fP указывает в середину промежутка,
то файловое смещение устанавливается в \fIoffset\fP. Если перед \fIoffset\fP нет
промежутка, то файловое смещение подгоняется к концу файла (т.е., это
скрытый промежуток, который есть в конце любого файла).
.PP
В обоих, показанных выше, случаях, \fBlseek\fP() завершится с ошибкой, если
\fIoffset\fP указывает за конец файла.

Эти операции позволяют приложениям отображать промежутки в разреженно
выделенном файле. Это может быть полезно для таких приложений, как
инструменты резервного копирования файлов, которые могут выиграть в месте
при создании резервных копий и сохранить промежутки, если у них есть
механизм их обнаружения.

.\" https://lkml.org/lkml/2011/4/22/79
.\" http://lwn.net/Articles/440255/
.\" http://blogs.oracle.com/bonwick/entry/seek_hole_and_seek_data
Для поддержки этих операций промежуток представляется последовательностью
нулей, которые (обычно) физически не занимают места на носителе. Однако
файловая система может не сообщать о промежутках, поэтому эти операции — не
гарантируемый механизм отображения пространства носителя в файл (более того,
последовательность нулей, которая на самом деле была записана на носитель,
может не посчитаться промежутком). В простейшей реализации, файловая система
может поддержать эти операции так: при \fBSEEK_HOLE\fP всегда возвращать
смещение конца файла, а при \fBSEEK_DATA\fP всегда возвращать значение
\fIoffset\fP (т.е., даже если расположение, указанное \fIoffset\fP, является
промежутком, это можно считать данными, состоящими из последовательности
нулей).
.SH "ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ"
При успешном выполнении \fBlseek\fP() возвращает получившееся в результате
смещение в байтах от начала файла. При ошибке возвращается значение
\fI(off_t)\ \-1\fP и в \fIerrno\fP записывается код ошибки.
.SH ОШИБКИ
.TP 
\fBEBADF\fP
\fIfd\fP не является открытым файловым дескриптором.
.TP 
\fBEINVAL\fP
.\" Some systems may allow negative offsets for character devices
.\" and/or for remote file systems.
Неправильное значение \fIwhence\fP. Получается, что возвращаемое файловое
смещение стало бы отрицательным или указывало бы за конец поверхности
носителя.
.TP 
\fBEOVERFLOW\fP
.\" HP-UX 11 says EINVAL for this case (but POSIX.1 says EOVERFLOW)
Результирующие файловое смещение не может быть представлено типом \fIoff_t\fP.
.TP 
\fBESPIPE\fP
Значение \fIfd\fP связано с каналом, сокетом или FIFO.
.TP 
\fBENXIO\fP
Значение \fIwhence\fP равно \fBSEEK_DATA\fP или \fBSEEK_HOLE\fP, и текущее файловое
смещение указывает за конец файла.
.SH "СООТВЕТСТВИЕ СТАНДАРТАМ"
SVr4, 4.3BSD, POSIX.1\-2001.

.\" FIXME . Review http://austingroupbugs.net/view.php?id=415 in the future
Значения \fBSEEK_DATA\fP и \fBSEEK_HOLE\fP являются нестандартными расширениями,
которые также есть в Solaris, FreeBSD и DragonFly BSD; их предложили
включить в следующую редакцию POSIX (выпуск 8).
.SH ЗАМЕЧАНИЯ
Некоторые устройства не могут выполнять смещения и в POSIX не указано какие
устройства должны поддерживать \fBlseek\fP().

.\" Other systems return the number of written characters,
.\" using SEEK_SET to set the counter. (Of written characters.)
В Linux при использовании \fBlseek\fP() на терминальных устройствах tty
возвращается \fBESPIPE\fP.

Если вы будете конвертировать старый код, используйте вместо значений
\fIwhence\fP следующие макросы:
.TS
c c
l l.
старое значение	новое значение
0	SEEK_SET
1	SEEK_CUR
2	SEEK_END
L_SET	SEEK_SET
L_INCR	SEEK_CUR
L_XTND	SEEK_END
.TE
.\" .PP
.\" SVr1-3 returns \fIlong\fP instead of \fIoff_t\fP,
.\" (ancient) BSD returns \fIint\fP.
.PP
Заметим, что файловые дескрипторы, созданные через \fBdup\fP(2) или \fBfork\fP(2),
используют общий указатель на текущее положение в файле, так что
позиционирование в таких файлах может приводить к состязательности
процессов.
.SH "СМОТРИТЕ ТАКЖЕ"
\fBdup\fP(2), \fBfork\fP(2), \fBopen\fP(2), \fBfseek\fP(3), \fBlseek64\fP(3),
\fBposix_fallocate\fP(3)

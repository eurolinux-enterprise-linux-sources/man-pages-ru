.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" Copyright (C) 1993 Rickard E. Faith <faith@cs.unc.edu>
.\" and Copyright (C) 1994 Andries E. Brouwer <aeb@cwi.nl>
.\" and Copyright (C) 2002, 2005 Michael Kerrisk <mtk.manpages@gmail.com>
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one.
.\"
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\"
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" 2008-10-06, mtk: Created this as a new page by splitting
.\"     umount/umount2 material out of mount.2
.\"
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH UMOUNT 2 2010\-06\-19 Linux "Руководство программиста Linux"
.SH ИМЯ
umount, umount2 \- размонтирует файловую систему
.SH ОБЗОР
.nf
\fB#include <sys/mount.h>\fP
.sp
\fBint umount(const char *\fP\fItarget\fP\fB);\fP
.sp
\fBint umount2(const char *\fP\fItarget\fP\fB, int \fP\fIflags\fP\fB);\fP
.fi
.SH ОПИСАНИЕ
.\" Note: the kernel naming differs from the glibc naming
.\" umount2 is the glibc name for what the kernel now calls umount
.\" and umount is the glibc name for oldumount
Вызовы \fBumount\fP() и \fBumount2\fP() удаляют присоединённую (самого верхнего
уровня) файловую систему, примонтированную к \fItarget\fP.

Для размонтирования файловых систем требуются права (Linux: мандат
\fBCAP_SYS_ADMIN\fP).

В Linux 2.1.116 добавлен системный вызов \fBumount2\fP(), который, подобно
\fBumount\fP(), размонтирует заданный объект, но позволяет указать
дополнительные флаги \fIflags\fP, контролирующие поведение операции:
.TP 
\fBMNT_FORCE\fP (начиная с Linux 2.1.116)
Принудительно размонтировать даже если файловая система занята. Может
привести к потере данных. (Только для смонтированной NFS.)
.TP 
\fBMNT_DETACH\fP (начиная с Linux 2.4.11)
Выполнить отложенное размонтирование: сделать точку монтирования недоступной
для новых подключений, и выполнить настоящее размонтирование только когда
точка доступа станет свободной.
.TP 
\fBMNT_EXPIRE\fP (начиная Linux 2.6.8)
Пометить точку монтирования как недействительную. Если точка монтирования в
это время не используется, то первоначальный вызов \fBumount2\fP() с этим
флагом завершится с ошибкой \fBEAGAIN\fP, но пометит точку монтирования как
недействительную. Точка монтирования остаётся недействительной до тех пор,
пока какой\-нибудь процесс не запросит к ней доступ. Второй вызов
\fBumount2\fP() с флагом \fBMNT_EXPIRE\fP размонтирует недействительную точку
монтирования. Этот флаг нельзя указывать вместе с \fBMNT_FORCE\fP или
\fBMNT_DETACH\fP.
.TP 
\fBUMOUNT_NOFOLLOW\fP (начиная с Linux 2.6.34)
.\" Later added to 2.6.33-stable
Не следовать по ссылке, если \fItarget\fP является символьной ссылкой. Это флаг
помогает избежать проблем с безопасностью в программах принадлежащих root и
с установленным битом set\-user\-ID, которые позволяют непривилегированным
пользователям размонтировать файловые системы.
.SH "ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ"
При успешном выполнении возвращается 0. В случае ошибки возвращается \-1, а
\fIerrno\fP устанавливается в соответствующее значение.
.SH ОШИБКИ
Коды ошибок, описанные ниже, не зависят от типа файловой системы. У каждой
файловой системы могут быть свои коды ошибок и своё собственное
поведение. Подробности смотрите в исходном коде ядра.
.TP 
\fBEAGAIN\fP
Вызов \fBumount2\fP() с флагом \fBMNT_EXPIRE\fP успешно пометил незанятую файловую
систему как недействительную.
.TP 
\fBEBUSY\fP
Объект \fItarget\fP не может быть размонтирован, так как он занят.
.TP 
\fBEFAULT\fP
Объект \fItarget\fP указывает вне адресного пространства, доступного
пользователю.
.TP 
\fBEINVAL\fP
Объект \fItarget\fP не является точкой монтирования. Или \fBumount2\fP() был
вызван с флагом \fBMNT_EXPIRE\fP и с \fBMNT_DETACH\fP или \fBMNT_FORCE\fP.
.TP 
\fBENAMETOOLONG\fP
Значение пути длиннее чем \fBMAXPATHLEN\fP.
.TP 
\fBENOENT\fP
Указан пустой путь или одна из его частей не существует.
.TP 
\fBENOMEM\fP
Ядро не может выделить свободную страницу для копирования имени файла или
данных.
.TP 
\fBEPERM\fP
Вызывающий процесс не имеет требуемых привилегий.
.SH ВЕРСИИ
.\" http://sourceware.org/bugzilla/show_bug.cgi?id=10092
Флаги \fBMNT_DETACH\fP и \fBMNT_EXPIRE\fP есть только в glibc начиная с версии
2.11.
.SH "СООТВЕТСТВИЕ СТАНДАРТАМ"
Эти функции есть только в Linux, и они не должны использоваться в
переносимых программах.
.SH ЗАМЕЧАНИЯ
Изначально функция \fBumount\fP() вызывалась как \fIumount(device)\fP и возвращала
\fBENOTBLK\fP при попытке работы с любым неблочным устройством. В Linux 0.98p4
был добавлен вызов \fIumount(dir)\fP для поддержки анонимных устройств. В Linux
2.3.99\-pre7 был убран вызов \fIumount(device)\fP, остался только \fIumount(dir)\fP
(теперь устройства могут быть подключены более чем к одной точке, поэтому
указания только устройства недостаточно).
.SH "СМОТРИТЕ ТАКЖЕ"
\fBmount\fP(2), \fBpath_resolution\fP(7), \fBmount\fP(8), \fBumount\fP(8)

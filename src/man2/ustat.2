.\" Copyright (C) 1995, Thomas K. Dyas <tdyas@eden.rutgers.edu>
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Created  1995-08-09 Thomas K. Dyas <tdyas@eden.rutgers.edu>
.\" Modified 1997-01-31 by Eric S. Raymond <esr@thyrsus.com>
.\" Modified 2001-03-22 by aeb
.\" Modified 2003-08-04 by aeb
.\"
.\" Дата последней коррекции перевода 24.05.2004
.\" Перевод с английского сделал Виктор Вислобоков <corochoone@perm.ru>
.\" http://www.linuxshare.ru/projects/trans/mans.html
.\"
.TH USTAT 2 2003-08-04 "Linux 2.4" "Руководство программста Linux"
.SH ИМЯ
ustat \- получить статистику по файловой системе
.SH ОБЗОР
.nf
.B #include <sys/types.h>
.br
.BR "#include <unistd.h>" "    /* libc[45] */"
.br
.BR "#include <ustat.h>" "     /* glibc2 */"
.sp
.BI "int ustat(dev_t " dev ", struct ustat *" ubuf );
.SH ОПИСАНИЕ
.B ustat
возвращает информацию о одной из смонтированных файловых систем.
.I dev
является номером устройства, которое идентифицирует устройство,
содержащее нужную файловую систему.
.I ubuf
является указателем на структуру ustat, которая имеет следующий
вид:

.sp
.RS
.nf
.ne 7
.ta 8n 16n 32n
daddr_t	f_tfree;	/* Всего свободных блоков */
ino_t	f_tinode;	/* Количество свободных индексных декскрипторов (inodes) */
char	f_fname[6];	/* Имя файловой системы */
char	f_fpack[6];	/* Упакованное имя файловой системы */
.ta
.fi
.RE
.PP

Последние два поля, f_fname и f_fpack не реализованы и всегда будут
заполнены нулевыми символами.
.SH "ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ"
В случае успеха возвращается ноль и структура ustat, на которую
указывает 
.I ubuf
будет заполнена значениями. В случае ошибки возвращается \-1 и
значение
.I errno
устанавливается соответствующим образом.
.SH ОШИБКИ
.TP
.B EINVAL
.I dev
не указывает на устройство, содержащее смонтированную файловую
систему.
.TP
.B EFAULT
.I ubuf
указывает за пределы доступного вам адресного пространства.
.TP
.B ENOSYS
Смонтированная файловая система, на которую ссылается
.I dev
не поддерживает данную операцию или у вас версия Linux меньше,
чем 1.3.16.
.SH "СООТВЕТСТВИЕ СТАНДАРТАМ"
SVr4.  SVr4 документирует дополнительные ошибки ENOLINK, ECOMM и EINTR
но не имеет ENOSYS.
.SH ЗАМЕЧАНИЯ
Функция
.B ustat
устарела и предоставляется только для совместимости. Все новые программы
должны использовать вместо неё вызов
.BR statfs (2).
.SH "ЗАМЕЧАНИЯ HP"
Версия структуры ustat от HP содержит дополнительное поле
.I f_blksize ,
которого в других версиях нет. HP предупреждает: В некоторых файловых
систем, количество свободных индексных дескрипторов (inodes) не
изменяется. Такие файловые системы возвращают в поле
.IR f_tinode
значение \-1.
.\" Some software tries to use this in order to test whether the
.\" underlying filesystem is NFS.
В некоторых файловых системах индексные дескрипторы выделяются
динамически. Такие файловые системы будут возвращаеть текущее
количество свободных индексных дескрипторов.
.SH "СМОТРИ ТАКЖЕ"
.BR statfs (2),
.BR stat (2)
.SH ПЕРЕВОД
Перевёл с английского Виктор Вислобоков <corochoone@perm.ru> 2004

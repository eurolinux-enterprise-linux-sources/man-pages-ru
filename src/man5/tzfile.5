.\" @(#)tzfile.5	7.11
.\" This file is in the public domain, so clarified as of
.\" 1996-06-05 by Arthur David Olson <arthur_david_olson@nih.gov>.
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH TZFILE 5 2012\-05\-04 "" "Руководство программиста Linux"
.SH ИМЯ
tzfile \- информация о часовом поясе
.SH ОПИСАНИЕ
В данной странице описана структура файлов часовых поясов, которые
используют функцией \fBtzset\fP(3). Обычно, эти файлы можно найти в каталоге
\fI/usr/lib/zoneinfo\fP или \fI/usr/share/zoneinfo\fP.

Файлы с информацией о часовых поясах начинаются со специальных символов
«TZif», указывающих, что это файл с информацией о часовом поясе, за которыми
следует символ версии формата файла (в виде 005, или ASCII NUL (\(aq\e0\(aq)
или \(aq2\(aq), затем 15 байтов с нулями, зарезервированные для их
последующего использования. После них находятся шесть четырехбайтных
значений типа \fIlong\fP, записанных в «стандартном» порядке байт (старший байт
записывается первым). Это следующие значения:
.TP 
\fItzh_ttisgmtcnt\fP
Количество UTC/локальных (local) индикаторов в файле
.TP 
\fItzh_ttisstdcnt\fP
Количество стандартных/местных (wall) индикаторов в файле
.TP 
\fItzh_leapcnt\fP
Количество високосных секунд, определённых в файле
.TP 
\fItzh_timecnt\fP
Количество "момент перевода часов", определённых в файле
.TP 
\fItzh_typecnt\fP
Количество "типов локального времени", определённых в файле (не должно быть
равно 0).
.TP 
\fItzh_charcnt\fP
Количество символов "строк аббревиатур часовых поясов", определённых в файле
.PP
За заголовком следуют четырехбайтные значения \fItzh_timecnt\fP типа \fIlong\fP,
расположенные в порядке возрастания. Эти значения записаны "стандартным"
порядком байт. Каждое из этих значений используется как момент перевода
часов (в формате, возвращаемом функцией \fBtime\fP(2)), при задании которого
изменяются правила вычисления локального времени. После этого следуют
однобайтные значения \fItzh_timecnt\fP типа \fIunsigned char\fP; каждое из этих
значений указывает, какому типу "локального времени", описанному в файле,
соответствует момент перевод часов с тем же индексом. Эти значения выступают
в роли индексов массива структур \fIttinfo\fP (с элементами \fItzh_typecnt\fP),
который находится в файле после этих значений. Структура определена так:
.in +4n
.sp
.nf
struct ttinfo {
    long         tt_gmtoff;
    int          tt_isdst;
    unsigned int tt_abbrind;
};
.in
.fi
.sp
Каждая структура состоит из четырехбайтного значения \fItt_gmtoff\fP типа
\fIlong\fP, записанного "стандартным" порядком байт; за этим значением следует
однобайтное значение \fItt_isdst\fP и однобайтное значение \fItt_abbrind\fP. В
каждой структуре \fItt_gmtoff\fP означает, сколько секунда надо добавить к UTC,
\fItt_isdst\fP определяет, будет ли \fItm_isdst\fP устанавливаться
\fBlocaltime\fP(3), и \fItt_abbrind\fP является индексом массива аббревиатур
часовых поясов; массив следует за структурами \fIttinfo\fP.
.PP
После этого массива находятся пары четырехбайтных значений \fItzh_leapcnt\fP,
записанные "стандартным" порядком байт; первое значение каждой пары задает
время (в формате \fBtime\fP(2)) високосной секунды; вторая пара определяет
\fIобщее\fP количество високосных секунд, добавляемых к указанному моменту
времени. Пары значений располагаются в порядке возрастания.
.PP
Затем в файле располагаются индикаторы стандартного/местного времени
\fItzh_ttisstdcnt\fP, каждый хранится в виде однобайтного значения; эти
индикаторы определяют, как связаны моменты перевода часов с локальными
типами времени: согласно стандартному или местному времени. Эти индикаторы
используются, когда файл с информацией о часовых поясах работает с
POSIX\-совместимыми переменными окружения часовых поясов.
.PP
И наконец, в этом файле находятся UTC/локальные индикаторы
\fItzh_ttisgmtcnt\fP, каждый хранится в виде однобайтного значения; эти
индикаторы определяют, как связаны моменты перевода часов с локальными
типами времени: согласно UTC или локальному времени. Эти индикаторы
используются, когда файл с информацией о часовых поясах работает с
POSIX\-совместимыми переменными окружения часовых поясов.
.PP
Функция \fIlocaltime\fP(3) использует первую структуру стандартного
стандартного времени \fIttinfo\fP из этого файла (или просто первую структуру
\fIttinfo\fP при отсутствии структуры стандартного времени), если значение
\fItzh_timecnt\fP равно нулю или аргумент времени меньше первого момента
перевода часов, записанного в файле.
.PP
Для файлов с информацией о часовых поясах версии 2, вышеприведённый
заголовок и данные, идущие за вторым заголовком и данными, идентичны по
формату, за исключением того, что для каждого перевода времени или
високосной секунды используется 8 байт. После второго заголовка и данных
следует закрывающий символ новой строки, строка в формате переменной TZ из
окружения POSIX для обработки моментов после последнего перевода времени,
хранящегося в файле (между символами новой строки ничего нет, если для таких
моментов нет представления POSIX).
.SH "СМОТРИТЕ ТАКЖЕ"
\fBctime\fP(3), \fBtzset\fP(3), \fBtzselect\fP(8) и \fItimezone/tzfile.h\fP из исходного
кода glibc.

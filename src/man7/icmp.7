.\" This man page is Copyright (C) 1999 Andi Kleen <ak@muc.de>.
.\" Permission is granted to distribute possibly modified copies
.\" of this page provided the header is included verbatim,
.\" and in case of nontrivial modification author and date
.\" of the modification is added to the header.
.\" $Id: icmp.7,v 1.6 2000/08/14 08:03:45 ak Exp $
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH ICMP 7 2012\-05\-10 Linux "Руководство программиста Linux"
.SH ИМЯ
icmp \- модуль ядра Linux, реализующий протокол IPv4 ICMP
.SH ОПИСАНИЕ
Этот модуль ядра реализует Internet Control Message Protocol, описанный в
RFC\ 792. Он используется для извещения об ошибках и для
диагностики. Пользователь не взаимодействует напрямую с этим модулем; вместо
этого он работает с другими протоколами в ядре, а они при помощи протокола
ICMP передают ошибки на уровень приложения. Кроме того, этот модуль отвечает
на ICMP\-запросы.
.PP
Пользовательский протокол может получать ICMP\-пакеты для всех локальных
сокетов, если откроет «сырой» сокет, используя протокол
\fBIPPROTO_ICMP\fP. Более подробную информацию смотрите в \fBraw\fP(7). Типы
ICMP\-пакетов, передаваемые в сокет, могут быть отфильтрованы с помощью
параметра сокета \fBICMP_FILTER\fP. Пакеты ICMP всегда обрабатываются ядром,
даже когда передаются в пользовательский сокет.
.LP
Linux ограничивает для каждого получателя поток ICMP\-пакетов с сообщениями
об ошибках. Количество \fBICMP_REDIRECT\fP и \fBICMP_DEST_UNREACH\fP также
ограничивается для каждого отправителя приходящих пакетов.
.SS "Интерфейсы в /proc"
.\" FIXME better description needed
Для настройки некоторых глобальных параметров IP ICMP поддерживает набор
интерфейсов в \fI/proc\fP. Эти параметры доступны на чтение и запись через
файлы в каталоге \fI/proc/sys/net/ipv4/\fP. Большинство параметров служит для
управления ограничением потока пакетов ICMP определённых типов. В Linux 2.2
для ограничения ICMP используется фильтр «протекающего ведра» (token
bucket). Значение — задержка в jiffy, отведённая на очистку фильтра после
всплеска. Величина jiffy зависит от архитектуры машины, обычно, это 10мс на
i386 и около 1мс на alpha и ia64.
.TP 
\fIicmp_destunreach_rate\fP (в Linux с 2.2 по 2.4.9)
.\" Precisely: from 2.1.102
Максимальная частота посылки ICMP\-пакетов с типом Destination Unreachable по
каждому конкретному маршруту или получателю. Ограничение не влияет на
посылку пакетов \fBICMP_FRAG_NEEDED\fP, необходимых для определения MTU для
маршрута.
.TP 
\fIicmp_echo_ignore_all\fP (начиная с Linux 2.2)
.\" Precisely: 2.1.68
Если значение больше нуля, то Linux будет игнорировать все запросы
\fBICMP_ECHO\fP.
.TP 
\fIicmp_echo_ignore_broadcasts\fP (начиная с Linux 2.2)
.\" Precisely: from 2.1.68
Если значение больше нуля, то Linux будет игнорировать все пакеты
\fBICMP_ECHO\fP, посланные по широковещательным адресам.
.TP 
\fIicmp_echoreply_rate\fP (в Linux с 2.2 по 2.4.9)
.\" Precisely: from 2.1.102
Максимальная частота посылки пакетов \fBICMP_ECHOREPLY\fP в ответ на запросы
\fBICMP_ECHOREQUEST\fP.
.TP 
\fIicmp_errors_use_inbound_ifaddr\fP (логический; по умолчанию: выключено; начиная с Linux 2.6.12)
.\" The following taken from 2.6.28-rc4 Documentation/networking/ip-sysctl.txt
Если выключено, то сообщения ICMP об ошибках посылаются с первичным адресом
существующего интерфейса.

Если включено, то сообщения будут посылаться с первичным адресом интерфейса,
на который поступил пакет, вызвавший ошибку ICMP. Такое поведение
соответствует работе маршрутизаторов, как этого ожидают сетевые
администраторы. Также, это позволяет облегчить диагностику проблем в сложных
сетях.

Заметим, что если на нужном интерфейсе первичный адрес не задан, то
используется адрес первого интерфейса, не являющегося обратной петлёй, и
значение данного параметра не учитывается.
.TP 
\fIicmp_ignore_bogus_error_responses\fP (логический; по умолчанию: выключено; начиная с Linux 2.2)
.\" precisely: since 2.1.32
.\" The following taken from 2.6.28-rc4 Documentation/networking/ip-sysctl.txt
Некоторые маршрутизаторы нарушают RFC1122, отправляя фиктивные ответы на
широковещательные пакеты. Эти нарушения, обычно, протоколируются
предупреждением ядра. Если этот параметр включён, то ядро не будет выдавать
такие предупреждения, что позволяет не засорять файл журнала.
.TP 
\fIicmp_paramprob_rate\fP (в Linux с 2.2 по 2.4.9)
.\" Precisely: from 2.1.102
Максимальная частота посылки пакетов \fBICMP_PARAMETERPROB\fP. Эти пакеты
посылаются, когда приходит пакет с ошибочным заголовком IP.
.TP 
\fIicmp_ratelimit\fP (целое; по умолчанию: 1000; начиная с Linux 2.4.10)
.\" The following taken from 2.6.28-rc4 Documentation/networking/ip-sysctl.txt
Ограничивает скорость отправки пакетов ICMP для определённого получателя,
чьи типы совпадают с \fIicmp_ratemask\fP (смотрите далее). Значение 0 отключает
ограничение, иначе указывается минимальная задержка между ответами в
миллисекундах.
.TP 
\fIicmp_ratemask\fP (целое; по умолчанию: смотрите далее; начиная с Linux 2.4.10)
.\" The following taken from 2.6.28-rc4 Documentation/networking/ip-sysctl.txt
Маска типов ICMP, для которых накладывается ограничение.

Расстановка битов: IHGFEDCBA9876543210
.br
Маска по умолчанию: 0000001100000011000 (0x1818)

Описание битов (смотрите файл \fIinclude/linux/icmp.h\fP из исходного кода
ядра):

.in +4n
.nf
0 Echo Reply (ответ Echo)
3 Destination Unreachable (назначение недоступно)*
4 Source Quench (подавление источника)*
5 Redirect (перенаправление)
8 Echo Request (запрос Echo)
B Time Exceeded (превышено время)*
C Parameter Problem (неверный параметр)*
D Timestamp Request (запрос метки времени)
E Timestamp Reply (ответ с меткой времени)
F Info Request (запрос Info)
G Info Reply (ответ Info)
H Address Mask Request (запрос маски адреса)
I Address Mask Reply (ответ с маской адреса)
.fi
.in

Для битов, помеченных звёздочкой, ограничение включено по умолчанию
(смотрите маску по умолчанию, приведённую ранее).
.TP 
\fIicmp_timeexceed_rate\fP (в Linux с 2.2 по 2.4.9)
Максимальная частота посылки пакетов \fBICMP_TIME_EXCEEDED\fP. Эти пакеты
посылаются для предотвращения зацикливания, когда пакет прошёл слишком
большое количество транзитных участков (hops).
.SH ВЕРСИИ
Поддержка запроса \fBICMP_ADDRESS\fP была удалена из 2.2.
.PP
Поддержка \fBICMP_SOURCE_QUENCH\fP была удалена из Linux 2.2.
.SH ЗАМЕЧАНИЯ
.\" not really true ATM
.\" .PP
.\" Linux ICMP should be compliant to RFC 1122.
Так как многие реализации не поддерживают «сырые» сокеты \fBIPPROTO_ICMP\fP, то
использование этой возможности нежелательно при написании переносимых
программ.
.PP
Пакеты \fBICMP_REDIRECT\fP не посылаются, если Linux не работает как
маршрутизатор. Также, они принимаются только от старых шлюзов, определённых
в таблице маршрутизации, причем информация о перенаправлении маршрутов
устаревает через некоторое время.
.PP
Значения 64\-битных временных меток, возвращаемых по \fBICMP_TIMESTAMP\fP,
отсчитываются в миллисекундах с начала Эпохи, 1970\-01\-01 00:00:00 +0000
(UTC).
.PP
В Linux\-реализации ICMP для посылки ICMP\-пакетов используются «сырые»
сокеты. Такие сокеты могут показываться программой \fBnetstat\fP(8), при этом
их inode будет равен 0.
.SH "СМОТРИТЕ ТАКЖЕ"
\fBip\fP(7)
.PP
В RFC\ 792 приведено описание протокола ICMP.

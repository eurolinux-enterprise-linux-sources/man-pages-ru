.\" This man page is Copyright (C) 1999 Andi Kleen <ak@muc.de>.
.\" Permission is granted to distribute possibly modified copies
.\" of this page provided the header is included verbatim,
.\" and in case of nontrivial modification author and date
.\" of the modification is added to the header.
.\" $Id: icmp.7,v 1.3 2001/05/26 23:45:00 alexm Exp $
.\" Вычитано и скорректировано by alexm@hsys.msk.ru для проекта
.\" http://alexm.here.ru/manpages-ru/
.TH ICMP 7 "27 апреля 1999" "Страница руководства по Linux" "Руководство программиста Linux" 
.SH НАЗВАНИЕ
icmp, IPPROTO_ICMP \- модуль ядра Linux, реализующий протокол IPv4 ICMP. 
.SH ОПИСАНИЕ
Этот модуль ядра реализует Internet Control Message Protocol (описанный в
RFC792). Он используется для извещения об ошибках и для диагностики.
Пользователь не взаимодействует напрямую с этим модулем; вместо этого он общается
с другими протоколами в ядре, а они при помощи протокола ICMP передают 
ошибки на уровень приложения.  Кроме того, этот модуль отвечает на
ICMP-запросы.
.PP
Пользовательский протокол может получать ICMP-пакеты для всех локальных сокетов, если
откроет "сырой" сокет, используя протокол
.BR IPPROTO_ICMP .
Смотри описание
.BR raw (7),
где приведена более подробная информация.
Типы ICMP-пакетов, передаваемые в сокет, могут быть отфильтрованы, используя
параметр сокета
.BR ICMP_FILTER .
Пакеты ICMP всегда обрабатываются ядром, даже когда передаются в 
пользовательский сокет.
.LP
Linux ограничивает для каждого получателя поток ICMP-пакетов с
сообщениями об ошибках.
Количество
.B ICMP_REDIRECT
и
.B ICMP_DEST_UNREACH
также ограничивается для каждого отправителя приходящих пакетов.

.SH SYSCTLS
ICMP поддерживает интерфейс sysctl для настройки некоторых глобальных параметров IP. 
К этим параметрам можно обращаться, читая и записывая файлы
.BR /proc/sys/net/ipv4/* ,
или же при помощи интерфейса 
.BR sysctl (2).
Большая часть этих параметров управляет ограничением потока
разнообразных ICMP-пакетов.
Linux 2.2 использует token bucket фильтр для ограничения ICMP пакетов.
.\" XXX  требуется более подробное описание
Значение таких параметров -- задержка в jiffies, пока
token-bucket-фильтр очищается после всплеска.  "Jiffy" -- это
системо-зависимая единица измерения, обычно 10мс на x86 и около 1ms на
Alpha и IA64.
.TP
.B icmp_destunreach_rate
Максимальная частота посылки ICMP-пакетов Destination Unreachable по
каждому конкретному маршруту или получателю.
Ограничение не влияет на посылку пакетов
.BR ICMP_FRAG_NEEDED ,
необходимых для определения MTU маршрута (path MTU discovery).
.TP
.B icmp_echo_ignore_all
Если этот параметр больше нуля, Linux будет игнорировать все запросы
.BR ICMP_ECHO .
.TP
.B icmp_echo_ignore_broadcasts
Если этот параметр больше нуля, Linux будет игнорировать все пакеты
.BR ICMP_ECHO ,
посланные по широковещательным адресам.
.TP
.B icmp_echoreply_rate
Максимальная частота посылки пакетов
.B ICMP_ECHOREPLY
в ответ на запросы
.BR ICMP_ECHOREQUEST .
.TP
.B icmp_paramprob_rate
Максимальная частота посылки пакетов
.BR ICMP_PARAMETERPROB .
Эти пакеты посылаются, когда приходит пакет с ошибочным заголовком IP.
.TP
.B icmp_timeexceed_rate
Максимальная частота посылки пакетов
.BR ICMP_TIME_EXCEEDED .
Эти пакеты посылаются для предотвращения зацикливания, когда пакет 
прошел слишком большое количество хопов.
.SH ПРИМЕЧАНИЯ
Так как многие реализации не поддерживают "сырые" сокеты с параметром
.BR IPPROTO_ICMP ,
то использование этой особенности нежелательно при написании
переносимых программ.
.\" не настоящий ATM
.\" .PP
.\" Linux ICMP должен быть совместим с RFC1122.
.PP
Пакеты 
.B ICMP_REDIRECT
не посылаются, когда Linux не является маршрутизатором.
Они принимаются только от старых шлюзов, определенных в таблице
маршрутизации, причем информация о перенаправлении маршрутов
устаревает через некоторое время.
.PP
64-битные временные метки
.B ICMP_TIMESTAMP
возвращаются в миллисекундах, прошедших с 1-го января 1970 года.
.PP
Реализация ICMP в Linux внутри себя использует для посылки
ICMP-пакетов "сырые" сокеты.  Такие сокеты могут показываться
программой
.BR netstat (8),
причем их inode будет равен нулю.
.PP
.SH ВЕРСИИ
Поддержка запроса 
.B ICMP_ADDRESS
была прекращена в ядре 2.2.
.PP
Поддержка 
.B ICMP_SOURCE_QUENCH
была прекращена в ядре Linux 2.2.
.SH СМОТРИ ТАКЖЕ
.BR ip (7)
.PP
RFC792, где описан протокол ICMP.
.RE
.SH ПЕРЕВОД
Перевел с английского Алексей Миллер <asm@asm.kiev.ua> 2000
